<!DOCTYPE html>
<html>
    <head>
        <label for="parameter">Parameter file</label>
        <input type="file" id="parameter" name="parameter">
        <label for="network">Network file</label>
        <input type="file" id="network" name="network">
        <label for="status">Status file</label>
        <input type="file" id="status" name="status">
        <button onclick="runGEMF()">RUN GEMF</button>
    </head>
    <body>
        <script async src="GEMF.js"></script>
        <script>
            let ready = false;
            Module = {
                onRuntimeInitialized: () => {
                    ready = true;
                }
            }

            const runGEMF = () => {
                if (ready) {
                    writeFile("parameter", "para.txt")();
                    writeFile("network", "network.txt")();
                    writeFile("status", "status.txt")();
                    FS.writeFile('output.txt', '');

                    setTimeout(() => {
                        Module.ccall('run_gemf', 'number', ['number', 'string'], [0, ""]);
                    }, 2000);

                    setTimeout(() => {
                        console.log(new TextDecoder().decode(FS.readFile('output.txt')));
                    }, 4000)
                }
            }

            const writeFile = (id, fileName) => {
                return () => {
                    const input = document.getElementById(id).files[0];
                    const reader = new FileReader();
                    reader.onload = () => {
                        FS.writeFile(fileName, reader.result);
                    }
                    reader.readAsText(input);
                }
            }
        </script>
    </body>
</html>